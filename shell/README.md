## Реализации оболочки Shell для Unix

_Написано на C_

Вся программма разделена на 4 модуля  
* **main.c** - главный модуль, координирующий работу модулей и совершающий диалог с пользователем  
* **list.c** - создает список из слов, которые выделяет из стандратного входного потока  
* **tree.c** - создает дерево по созданнмк списку (элементами дерева являются команды и информация о них)  
* **exec.c** - запускает программы, которые указаны в дереве  

Соединение модулей просиходит при помощи Makefile


## main.c
Используются библиотеки:
```
#include <stdio.h>
#include <stdlib.h>
#include <setjmp.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>
#include <sys/types.h>
#include <fcntl.h>
#include <signal.h>
#include "list.h"
#include "tree.h"
#include "exec.h"
```
Модкль содержит функции:  
`void inv()` создает диалог с пользователем (приглашает к вводу)

`void zombi()` удаляет зомби, которые моглм возникнуть в связи с зверешением команд, которые были запущены на фоне

`void jdem()` функция ждет заврешения всех фоновых процессов (которые еще не закончились к данному моменту)

`void rfv()` реакция на сигнал **SIGINT**

В основной программе задается реакция на сигнала  **SIGINT** и запускается бесконечный цикл, который работае по следующему алгоритму:
1) Отчищается дерево
2) Отчищется списко из слов
3) Удаляются зомби
4) Печается приглашение к вводу
5) Создается список из слов
6) Производится проверка на пустой список (в этом случае идем к началу цикла), на конец программы при помощи команды _exit_  или ctrl + D (в этом случае очищается лист, ожидается завршение всех фоновых процессов и завершается пограмма), на '#' (в этом случае команда воспринимается как комментарий)
7) Создается дерево по списку слов
8) Удаляются зомби
9) Выполняются команды по построенному дереву



## list.c 
Используются библиотеки:
```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
```
Модуль содержит функции:  
`void nullbuf()` удаление буфера

`void addsym()` добавление символа в буфер

`void addword()` добавление буфера в список  

`void clearlist(char **lst)` удаление списка  

`void null_list()` обнуление списка  

`void termlist() ` завершение списка  

`void printlist(char **lst)` печать списка  

`int symset(int c)` возвращает 1 если любой сивол кроме специальных  

`int getsym()` возвращает символ из строки

`char **create_list() ` главная функция, создающая список

В _list.h_ занесены следующие функции:
```
void printlist(char **lst);
void clearlist(char **lst);
char **create_list();
```

## tree.c 
Используются библиотеки:
```
#include <stdio.h>
#include <stdlib.h>
#include <setjmp.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>
#include <fcntl.h>
#include "list.h"
```
Описание типа _дерева_:
```typedef struct cmd_inf *tree;
typedef struct cmd_inf 
{
    char ** argv; // список из имени команды и аргументов
    char *infile; // переназначенный файл стандартного ввода
    int typeout; // =1 если >> 
    char *outfile; // переназначенный файл стандартного вывода
    int backgrnd; // =1, если команда подлежит выполнению в фоновом режиме cmd_inf* psubcmd; // команды для запуска в дочернем shell
   // int num; // кол-во процессов в pr1 | pr2 | pr3...
    tree psubcmd; //запуск дочернего
    tree pipe; // следующая команда после “|”
    tree next_one; // следующая после “;” (или после “&”)
    tree next_two; //следущая после "||"
    tree next_three; //следующая после  "&&"
}info;
```
Модуль содержит функции: 
`tree create_tree()` создает дерево

`tree null_tree()` создает новое звено для дерева и обнуляет всего его поля  

`tree postr()` заполняет звено в дерево, исходя из переданного списка  

`void print_tree(tree tr)` печатет информацию о звене дерева   

`void clear_tree(tree tr)` очищает дерево (то есть очищают всею информацию о каждом звене дерева)  

В _tree.h_ занесены следующие функции:
```
tree create_tree();
void print_tree(tree tr);
void clear_tree(tree tr);
```

## exec.c 
Используются библиотеки:
```
#include <stdio.h>
#include <stdlib.h>
#include <setjmp.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>
#include <sys/types.h>
#include <fcntl.h>
#include <signal.h>
#include "tree.h"
```
Описание типа списка для фоновых прцессов:
```
typedef struct backgrndList {
    int pid;
    struct backgrndList *next;
} intlist;
typedef intlist *bckgrnd;
```
Модуль содержит функции:   
`void pwd(tree tr)` моделирует команду _pwd_  

`void cd(tree tr)` моделирует команду _cd_  

`void cmd(tree tr)` перенаправляет ввод/вывод на файлы (если они указаны) и запсукает команду (при помощи _execvp()_)  

`int wait_status(tree tr, int pid)` ожидает завершения процесса и возварщает статус заврешения программы (если он был запущен не в фономов режиме)  

`int konez(tree tr)` возвращает 1, если находимя на последнем звене в дереве  

`int vnutr(tree tr)` возвращает 1, команда является внутреней (pwd, cd, ext...)

`void go(tree tr)` осущствляет компановку и координацию процессов (для пайма, для последвательного выполнения, для  ||, для &&)  

`void do_exec(tree tr)` запускает выполнение функций  


В _exec.h_ занесены следующие функции:
```
void do_exec(tree tr);
```


## Запуск и компиляция
Компиляция происходит при помощи `make shell`  
Запуск при помощи `./shell`
